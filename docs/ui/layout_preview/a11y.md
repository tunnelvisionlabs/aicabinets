# Layout Preview Accessibility

The layout preview renders inline SVG with a roving tabindex controller so the
bay elements are reachable by keyboard and announced with meaningful names.
This document summarizes the attributes, key bindings, and styling tokens that
compose the accessibility layer.

## Roles and Labels

* The wrapper element (`.lp-root`) exposes `role="img"` with
  `aria-label="Cabinet front preview"`. When no bays are present, the wrapper
  remains tabbable.
* Each bay group (`<g data-role="bay">`) becomes focusable via the roving
  tabindex controller. The controller sets:
  * `tabindex` â€” exactly one bay has `tabindex="0"`; all others are `-1`.
  * `aria-label="Bay N, {width} by {height} millimeters"` by default. A custom
    `unitLabel(mm)` formatter passed to `LayoutPreview.a11y.init` can replace the
    unit string, e.g., for imperial display.
  * `aria-selected="true"` on the active bay so screen readers announce the
    current selection.

## Keyboard Navigation

The roving tabindex follows the active bay when focus leaves the preview. When
focus enters the wrapper, it automatically moves to the active bay (if any) or
the first bay.

Key bindings supported by `LayoutPreview.a11y`:

| Key             | Effect                                             |
| ----------------| --------------------------------------------------- |
| `ArrowLeft`     | Move focus to the previous bay (no wrap).           |
| `ArrowRight`    | Move focus to the next bay (no wrap).               |
| `Home`          | Jump focus to the first bay.                        |
| `End`           | Jump focus to the last bay.                         |
| `Enter` / Space | Invoke `requestSelectBay` for the focused bay.      |

The keyboard selection path dispatches the same `click` flow as mouse
interaction, ensuring Ruby receives the existing `requestSelectBay` callback.

## Focus vs. Active Styling

Active bays continue to use the filled highlight from `renderer.css`. Keyboard
focus adds a dashed stroke rendered through the `.is-focused` class (fallback
for browsers without `:focus-visible`) and `:focus-visible`. CSS variables keep
the focus styling configurable:

```css
--lp-focus-ring-width
--lp-focus-ring-color
--lp-focus-ring-fill
```

When a different bay holds focus, the active bay retains its highlight while the
focused bay shows the ring, making the two states visually distinct.

## Selection Synchronization

The renderer continues to call `LayoutPreview.setActiveBay` to keep scope and
selection in sync with the form. The accessibility module listens for those
updates via `LayoutPreview.a11y.setActiveBay`, which refreshes `aria-selected`
and the roving tabindex anchor without stealing focus unless the currently
focused bay was removed.
